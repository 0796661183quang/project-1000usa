/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package edu.poly.ui;

import edu.poly.Helper.databaseHelper;
import edu.poly.object.modelHopDong;
import edu.poly.object.modelTien;
import edu.poly.objectDAO.editHopDongDao;
import java.sql.Connection;
import java.sql.Date;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.logging.Level;
import java.util.logging.Logger;
import java.util.logging.SimpleFormatter;
import javax.swing.DefaultListModel;
import javax.swing.JComboBox;
import javax.swing.JFrame;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.ListModel;
import javax.swing.ListSelectionModel;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author dinh
 */
public class addHopDongPanel extends javax.swing.JPanel {

    /**
     * Creates new form addHopDong
     */
    public addHopDongPanel() {
        initComponents();
        editHopDongDao.setSoLuongXe();
        loadCBX("LOAIXE", cbxMaLoaiXe);
        loadCBX("PHUKIEN", cbxMaPK);
        loadCBX("KHACHHANG", cbxSoCMND);
        loadListBoxSanSang();
        loadDataTable();

    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        jScrollPane2 = new javax.swing.JScrollPane();
        tblKh = new javax.swing.JTable();
        CenterBottom = new javax.swing.JPanel();
        btnXeAdd = new javax.swing.JButton();
        btnAddReset1 = new javax.swing.JButton();
        btnEditXe = new javax.swing.JButton();
        btnEditXe1 = new javax.swing.JButton();
        Left = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        txtMaHD = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        dpkNgayLap = new org.jdesktop.swingx.JXDatePicker();
        jLabel4 = new javax.swing.JLabel();
        cbxSoCMND = new javax.swing.JComboBox<>();
        jLabel5 = new javax.swing.JLabel();
        dpkTimeBatDauHD = new org.jdesktop.swingx.JXDatePicker();
        jLabel6 = new javax.swing.JLabel();
        dpkTimeKetThucHD = new org.jdesktop.swingx.JXDatePicker();
        jLabel7 = new javax.swing.JLabel();
        txtDiemNhanXe = new javax.swing.JTextField();
        jLabel8 = new javax.swing.JLabel();
        txtDiemTraXe = new javax.swing.JTextField();
        jLabel9 = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        tareaGhiChu = new javax.swing.JTextArea();
        jLabel18 = new javax.swing.JLabel();
        cbxTinhTrangHD = new javax.swing.JComboBox<>();
        Right = new javax.swing.JPanel();
        jLabel15 = new javax.swing.JLabel();
        jLabel17 = new javax.swing.JLabel();
        jScrollPane3 = new javax.swing.JScrollPane();
        jList1 = new javax.swing.JList<>();
        jButton2 = new javax.swing.JButton();
        jButton1 = new javax.swing.JButton();
        jScrollPane4 = new javax.swing.JScrollPane();
        jList2 = new javax.swing.JList<>();
        cbxMaLoaiXe = new javax.swing.JComboBox<>();
        jLabel10 = new javax.swing.JLabel();
        cbxMaPK = new javax.swing.JComboBox<>();
        jLabel11 = new javax.swing.JLabel();
        cbxDatCoc = new javax.swing.JComboBox<>();
        jLabel13 = new javax.swing.JLabel();
        txtMaTT = new javax.swing.JTextField();
        txtTienThueXe = new javax.swing.JTextField();
        txtTienSuaChua = new javax.swing.JTextField();
        txtTongTien = new javax.swing.JTextField();
        jLabel12 = new javax.swing.JLabel();
        jLabel14 = new javax.swing.JLabel();
        jLabel16 = new javax.swing.JLabel();

        jLabel1.setFont(new java.awt.Font("Dialog", 1, 18)); // NOI18N
        jLabel1.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel1.setText("HỢP ĐỒNG");

        tblKh.setBorder(javax.swing.BorderFactory.createTitledBorder(""));
        tblKh.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {

            }
        ));
        tblKh.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tblKhMouseClicked(evt);
            }
        });
        jScrollPane2.setViewportView(tblKh);

        CenterBottom.setPreferredSize(new java.awt.Dimension(88, 88));

        btnXeAdd.setIcon(new javax.swing.ImageIcon(getClass().getResource("/edu/poly/icon/icon/save-20.png"))); // NOI18N
        btnXeAdd.setText("Thêm");
        btnXeAdd.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnXeAddActionPerformed(evt);
            }
        });

        btnAddReset1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/edu/poly/icon/icon/reset-20.png"))); // NOI18N
        btnAddReset1.setText("Đặt lại");
        btnAddReset1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnAddReset1ActionPerformed(evt);
            }
        });

        btnEditXe.setIcon(new javax.swing.ImageIcon(getClass().getResource("/edu/poly/icon/icon/save-20.png"))); // NOI18N
        btnEditXe.setText("Lưu thay đổi");
        btnEditXe.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnEditXeActionPerformed(evt);
            }
        });

        btnEditXe1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/edu/poly/icon/icon/save-20.png"))); // NOI18N
        btnEditXe1.setText("Xóa");
        btnEditXe1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnEditXe1ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout CenterBottomLayout = new javax.swing.GroupLayout(CenterBottom);
        CenterBottom.setLayout(CenterBottomLayout);
        CenterBottomLayout.setHorizontalGroup(
            CenterBottomLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(CenterBottomLayout.createSequentialGroup()
                .addGap(20, 20, 20)
                .addComponent(btnXeAdd, javax.swing.GroupLayout.PREFERRED_SIZE, 144, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(48, 48, 48)
                .addComponent(btnEditXe)
                .addGap(49, 49, 49)
                .addComponent(btnEditXe1)
                .addGap(47, 47, 47)
                .addComponent(btnAddReset1, javax.swing.GroupLayout.PREFERRED_SIZE, 144, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(472, Short.MAX_VALUE))
        );
        CenterBottomLayout.setVerticalGroup(
            CenterBottomLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(CenterBottomLayout.createSequentialGroup()
                .addGap(19, 19, 19)
                .addGroup(CenterBottomLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnXeAdd)
                    .addComponent(btnAddReset1)
                    .addComponent(btnEditXe)
                    .addComponent(btnEditXe1))
                .addContainerGap(20, Short.MAX_VALUE))
        );

        Left.setCursor(new java.awt.Cursor(java.awt.Cursor.DEFAULT_CURSOR));
        Left.setPreferredSize(new java.awt.Dimension(200, 200));

        jLabel2.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel2.setText("Mã Hợp Đồng:");

        jLabel3.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel3.setText("Ngày Lập:");

        dpkNgayLap.setFormats("dd/MM/yyyy");

        jLabel4.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel4.setText("Số CMND:");

        jLabel5.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel5.setText("Thời gian bắt đầu HĐ:");

        dpkTimeBatDauHD.setFormats("dd/MM/yyyy");

        jLabel6.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel6.setText("Thời gian kết thúc HĐ:");

        dpkTimeKetThucHD.setFormats("dd/MM/yyyy");

        jLabel7.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel7.setText("Địa điểm nhận xe:");

        jLabel8.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel8.setText("Địa điểm trả xe:");

        jLabel9.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel9.setText("Ghi chú:");

        tareaGhiChu.setColumns(20);
        tareaGhiChu.setRows(5);
        jScrollPane1.setViewportView(tareaGhiChu);

        jLabel18.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel18.setText("Tình Trạng Hợp Đồng:");

        cbxTinhTrangHD.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Hoạt Động", "Kết Thúc" }));

        javax.swing.GroupLayout LeftLayout = new javax.swing.GroupLayout(Left);
        Left.setLayout(LeftLayout);
        LeftLayout.setHorizontalGroup(
            LeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(LeftLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(LeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(LeftLayout.createSequentialGroup()
                        .addComponent(jLabel18)
                        .addGap(10, 10, 10)
                        .addComponent(cbxTinhTrangHD, javax.swing.GroupLayout.PREFERRED_SIZE, 235, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(LeftLayout.createSequentialGroup()
                        .addGroup(LeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(jLabel2)
                            .addComponent(jLabel4)
                            .addComponent(jLabel5)
                            .addComponent(jLabel6)
                            .addComponent(jLabel7)
                            .addComponent(jLabel8)
                            .addComponent(jLabel9)
                            .addComponent(jLabel3))
                        .addGroup(LeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(LeftLayout.createSequentialGroup()
                                .addGap(10, 10, 10)
                                .addGroup(LeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                    .addComponent(txtMaHD)
                                    .addComponent(dpkNgayLap, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                    .addComponent(cbxSoCMND, javax.swing.GroupLayout.PREFERRED_SIZE, 235, javax.swing.GroupLayout.PREFERRED_SIZE)))
                            .addGroup(LeftLayout.createSequentialGroup()
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(dpkTimeKetThucHD, javax.swing.GroupLayout.PREFERRED_SIZE, 235, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, LeftLayout.createSequentialGroup()
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addGroup(LeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(txtDiemNhanXe, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 235, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(txtDiemTraXe, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 235, javax.swing.GroupLayout.PREFERRED_SIZE)))
                            .addGroup(LeftLayout.createSequentialGroup()
                                .addGap(10, 10, 10)
                                .addGroup(LeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(dpkTimeBatDauHD, javax.swing.GroupLayout.PREFERRED_SIZE, 235, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(jScrollPane1, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 235, javax.swing.GroupLayout.PREFERRED_SIZE))))))
                .addContainerGap(196, Short.MAX_VALUE))
        );
        LeftLayout.setVerticalGroup(
            LeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(LeftLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(LeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 20, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txtMaHD))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(LeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(dpkNgayLap, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel3))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(LeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel4)
                    .addComponent(cbxSoCMND, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(LeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel5)
                    .addComponent(dpkTimeBatDauHD, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(LeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel6)
                    .addComponent(dpkTimeKetThucHD, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(LeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel7)
                    .addComponent(txtDiemNhanXe, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(LeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel8)
                    .addComponent(txtDiemTraXe, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(LeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel9)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(LeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel18)
                    .addComponent(cbxTinhTrangHD, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(4, 4, 4))
        );

        Right.setPreferredSize(new java.awt.Dimension(200, 200));

        jLabel15.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel15.setText("Tiền Sửa Chửa:");

        jLabel17.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel17.setText("Tên Loại Phụ Kiện:");

        jScrollPane3.setViewportView(jList1);

        jButton2.setText(">>");
        jButton2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton2ActionPerformed(evt);
            }
        });

        jButton1.setText("<<");
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });

        jScrollPane4.setViewportView(jList2);

        jLabel10.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel10.setText("Tên Loại Xe:");

        jLabel11.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel11.setText("Mã Phụ Kiện:");

        cbxDatCoc.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Tien", "Xe may" }));

        jLabel13.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel13.setText("Đặt cọc:");

        jLabel12.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel12.setText("Mã Thanh Toán:");

        jLabel14.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel14.setText("Tiền Thuê Xe:");

        jLabel16.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel16.setText("Tổng Tiền:");

        javax.swing.GroupLayout RightLayout = new javax.swing.GroupLayout(Right);
        Right.setLayout(RightLayout);
        RightLayout.setHorizontalGroup(
            RightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(RightLayout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(RightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel17, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel16, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel15, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel14, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel12, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel13, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel11, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel10, javax.swing.GroupLayout.Alignment.TRAILING))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(RightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(RightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                        .addComponent(cbxMaLoaiXe, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(cbxMaPK, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(cbxDatCoc, 0, 208, Short.MAX_VALUE)
                        .addComponent(txtMaTT)
                        .addComponent(txtTienThueXe)
                        .addComponent(txtTienSuaChua)
                        .addComponent(txtTongTien))
                    .addGroup(RightLayout.createSequentialGroup()
                        .addComponent(jScrollPane3, javax.swing.GroupLayout.PREFERRED_SIZE, 162, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(RightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jButton2)
                            .addComponent(jButton1))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(jScrollPane4, javax.swing.GroupLayout.PREFERRED_SIZE, 166, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addGap(0, 53, Short.MAX_VALUE))
        );
        RightLayout.setVerticalGroup(
            RightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(RightLayout.createSequentialGroup()
                .addGap(7, 7, 7)
                .addGroup(RightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel10)
                    .addComponent(cbxMaLoaiXe, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(RightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel11)
                    .addComponent(cbxMaPK, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(RightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel13)
                    .addComponent(cbxDatCoc, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(RightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel12)
                    .addComponent(txtMaTT, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(RightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel14)
                    .addComponent(txtTienThueXe, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(RightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel15)
                    .addComponent(txtTienSuaChua, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(RightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel16)
                    .addComponent(txtTongTien, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGroup(RightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(RightLayout.createSequentialGroup()
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(RightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                            .addComponent(jScrollPane4)
                            .addComponent(jLabel17, javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jScrollPane3)))
                    .addGroup(RightLayout.createSequentialGroup()
                        .addGap(49, 49, 49)
                        .addComponent(jButton2)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jButton1)))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane2)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 1116, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(0, 0, Short.MAX_VALUE))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addGap(0, 0, Short.MAX_VALUE)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                                .addComponent(Left, javax.swing.GroupLayout.PREFERRED_SIZE, 558, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(0, 0, 0)
                                .addComponent(Right, javax.swing.GroupLayout.PREFERRED_SIZE, 558, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addComponent(CenterBottom, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 1116, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jLabel1)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 238, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(CenterBottom, javax.swing.GroupLayout.PREFERRED_SIZE, 68, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(Right, javax.swing.GroupLayout.DEFAULT_SIZE, 369, Short.MAX_VALUE)
                    .addComponent(Left, javax.swing.GroupLayout.DEFAULT_SIZE, 369, Short.MAX_VALUE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        Left.getAccessibleContext().setAccessibleParent(Left);
    }// </editor-fold>//GEN-END:initComponents
    String valueOfCBXTinhTrangHD;
    private void tblKhMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tblKhMouseClicked
        editHopDongDao hd = new editHopDongDao();
        txtMaHD.setText(String.valueOf(tblKh.getValueAt(rowSelected(), 0)));
        try {
            dpkNgayLap.setDate(new SimpleDateFormat("yyyy-MM-dd").parse(String.valueOf(tblKh.getValueAt(rowSelected(), 1))));
            dpkTimeBatDauHD.setDate(new SimpleDateFormat("yyyy-MM-dd").parse(String.valueOf(tblKh.getValueAt(rowSelected(), 3))));
            dpkTimeKetThucHD.setDate(new SimpleDateFormat("yyyy-MM-dd").parse(String.valueOf(tblKh.getValueAt(rowSelected(), 4))));
        } catch (ParseException ex) {
            ex.printStackTrace();
        }
        cbxSoCMND.setSelectedItem(String.valueOf(tblKh.getValueAt(rowSelected(), 2)));
        txtDiemNhanXe.setText(String.valueOf(tblKh.getValueAt(rowSelected(), 5)));
        txtDiemTraXe.setText(String.valueOf(tblKh.getValueAt(rowSelected(), 6)));
        tareaGhiChu.setText(String.valueOf(tblKh.getValueAt(rowSelected(), 7)));
        cbxTinhTrangHD.setSelectedItem(String.valueOf(tblKh.getValueAt(rowSelected(), 8)));
        valueOfCBXTinhTrangHD = String.valueOf(tblKh.getValueAt(rowSelected(), 8));
//        System.out.println("in Ten loai xe: "+hd.convertMaLoaiXeToLoaiXe(String.valueOf(tblKh.getValueAt(rowSelected(), 9))));
//        cbxMaLoaiXe.setSelectedItem(hd.convertMaLoaiXeToLoaiXe(String.valueOf(tblKh.getValueAt(rowSelected(), 9))));
        loadCBX("LOAIXE", cbxMaLoaiXe);
//        System.out.println("kq: "+checkNullCBX(cbxMaLoaiXe.getItemAt(i)));
//        System.out.println("kq compare: "+compareItemOfCBX());
        if (compareItemOfCBX()) {
            cbxMaLoaiXe.addItem(hd.convertMaLoaiXeToLoaiXe(String.valueOf(tblKh.getValueAt(rowSelected(), 9))));
        }

        cbxMaLoaiXe.setSelectedItem(hd.convertMaLoaiXeToLoaiXe(String.valueOf(tblKh.getValueAt(rowSelected(), 9))));
//        cbxMaPK.setSelectedItem(String.valueOf(tblKh.getValueAt(rowSelected(), 10)));
        cbxDatCoc.setSelectedItem(String.valueOf(tblKh.getValueAt(rowSelected(), 12)));
        loadListBoxDangChoThue(String.valueOf(tblKh.getValueAt(rowSelected(), 10)));
//        cbxTinhTrangHD.setSelectedItem(ABORT);
        txtMaTT.setText(String.valueOf(tblKh.getValueAt(rowSelected(), 11)));
        txtTienThueXe.setText(String.valueOf(tblKh.getValueAt(rowSelected(), 13)));
        txtTienSuaChua.setText(String.valueOf(tblKh.getValueAt(rowSelected(), 14)));
        txtTongTien.setText(String.valueOf(tblKh.getValueAt(rowSelected(), 15)));
    }//GEN-LAST:event_tblKhMouseClicked
    private void loadListBoxDangChoThue(String strMaLoaiPK) {
        DefaultListModel listModel2 = new DefaultListModel();
        String[] maLoaiPK = strMaLoaiPK.split(",");
//        System.out.println("do dai: "+maLoaiPK.length);
        for (int i = 0; i < maLoaiPK.length; i++) {
//            System.out.println("ma loai PK in selected"+i+" table: " + maLoaiPK[i]);
            try {
                String sql = "select TenLoaiPK from LOAIPHUKIEN where MaLoaiPK = '" + maLoaiPK[i].trim() + "'";
                Connection con = databaseHelper.openConnection();
                Statement sttm = con.createStatement();
                ResultSet rs = sttm.executeQuery(sql);
                while (rs.next()) {
                    listModel2.addElement(rs.getString(1));
                }

            } catch (Exception ex) {
                ex.printStackTrace();
            }
        }
        jList2.setModel(listModel2);
    }

    private boolean compareItemOfCBX() {
        boolean kq = true;
        editHopDongDao hd = new editHopDongDao();
        int i = 0;
        for (; checkNullCBX(cbxMaLoaiXe.getItemAt(i)); i++) {
//            System.out.println("ten loai xe cbx "+i+" la: "+cbxMaLoaiXe.getItemAt(i));
            if (cbxMaLoaiXe.getItemAt(i).equals(hd.convertMaLoaiXeToLoaiXe(String.valueOf(tblKh.getValueAt(rowSelected(), 9))))) {
                kq = false;
                break;
            }
        }
        return kq;
    }

    private boolean checkNullCBX(String valueItem) {
        boolean kq = false;
        if (valueItem != null) {
            kq = true;
        }
        return kq;
    }
    private void btnEditXe1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnEditXe1ActionPerformed
        editHopDongDao editHD = new editHopDongDao();
        modelHopDong hd = new modelHopDong();
        hd.setMaHD(Integer.parseInt(txtMaHD.getText()));

        modelTien t = new modelTien();
        t.setMaTT(txtMaTT.getText());
        if (editHD.xoaHopDong(hd, t) == 1) {
            JOptionPane.showMessageDialog(this, "Xoa Hop Dong thanh cong");
        } else {
            JOptionPane.showMessageDialog(this, "Xoa Hop Dong khong thanh cong");
        }

        loadDataTable();
    }//GEN-LAST:event_btnEditXe1ActionPerformed

    private void btnEditXeActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnEditXeActionPerformed
        if (capNhatHopDong() == 1) {
            loadDataTable();
            editHopDongDao.setSoLuongXe();
            editHopDongDao.setSoLuongPK();
            loadListBoxSanSang();

            JOptionPane.showMessageDialog(this, "Cap nhat Hop Dong thanh cong!");
        } else
            JOptionPane.showMessageDialog(this, "Hay nhap day du cac field!");
    }//GEN-LAST:event_btnEditXeActionPerformed

    private void btnAddReset1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnAddReset1ActionPerformed
        txtMaHD.setText("");
        dpkNgayLap.setDate(null);
        dpkTimeBatDauHD.setDate(null);
        dpkTimeKetThucHD.setDate(null);
        txtDiemNhanXe.setText("");
        txtDiemTraXe.setText("");
        tareaGhiChu.setText("");
        txtMaTT.setText("");
        txtTienThueXe.setText("");
        txtTienSuaChua.setText("");
        txtTongTien.setText("");
        //        loadCBX("LOAIXE", cbxMaLoaiXe);
        //        loadCBX("PHUKIEN", cbxMaPK);
        //        loadCBX("KHACHHANG", cbxSoCMND);
    }//GEN-LAST:event_btnAddReset1ActionPerformed

    private void btnXeAddActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnXeAddActionPerformed
        if (btnXeAdd.getText() == "Thêm") {
            txtMaHD.setText("");
            dpkNgayLap.setDate(null);
            dpkTimeBatDauHD.setDate(null);
            dpkTimeKetThucHD.setDate(null);
            txtDiemNhanXe.setText("");
            txtDiemTraXe.setText("");
            tareaGhiChu.setText("");
            txtMaTT.setText("");
            txtTienThueXe.setText("");
            txtTienSuaChua.setText("");
            txtTongTien.setText("");
            btnXeAdd.setText("Lưu");
            loadCBX("LOAIXE", cbxMaLoaiXe);
            listModelPhuKienDangThue.removeAllElements();
        } else if (btnXeAdd.getText() == "Lưu") {
            if (themHopDong() == 1) {
                loadDataTable();
                JOptionPane.showMessageDialog(this, "Them Hop Dong thanh cong!");
                editHopDongDao.setSoLuongXe();
                editHopDongDao.setSoLuongPK();
                loadCBX("LOAIXE", cbxMaLoaiXe);
                loadListBoxSanSang();
            } else {
                JOptionPane.showMessageDialog(this, "Hay nhap day du cac field!");
            }
        }
    }//GEN-LAST:event_btnXeAddActionPerformed
    DefaultListModel listModelPhuKienDangThue = new DefaultListModel();
    private void jButton2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton2ActionPerformed
//        for (int i = 0; i < jList1.getModel().getSize(); i++) {

        if (soSanhItem2ListPhuKien()) {
            listModelPhuKienDangThue.addElement(jList1.getSelectedValue());
        }

//        System.out.println("list value: " + jList1.getSelectedValue());
//        }
        jList2.setModel(listModelPhuKienDangThue);
    }//GEN-LAST:event_jButton2ActionPerformed

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
//        ArrayList<String> listIndexSelected = new ArrayList<>();
//        for (int i = 0; i < jList2.gets; i++) {

//        }
        DefaultListModel listModelPhuKienDangThue2 = (DefaultListModel) jList2.getModel();
//        System.out.println("index list 2 remove: " + jList2.getSelectedIndex());
//        System.out.println("value of listPKCT remove: " + listModelPhuKienDangThue.toString());
        listModelPhuKienDangThue2.remove(jList2.getSelectedIndex());
//        jList2.setModel(listModelPhuKienDangThue);
//        if (jList2.getSelectedIndex()!=-1) {
//            listModelPhuKienDangThue.remove(jList2.getSelectedIndex());
//        }
//        jList2
    }//GEN-LAST:event_jButton1ActionPerformed
    private boolean soSanhItem2ListPhuKien() {
        boolean kq = true;
        for (int i = 0; i < jList2.getModel().getSize(); i++) {
//            System.out.println("jlist2 [" + i + "]: " + jList2.getModel().getElementAt(i));
//            System.out.println(" selected jlist1: " + jList1.getSelectedValue());
//            System.out.println("\n");
            if (jList2.getModel().getElementAt(i).equals(jList1.getSelectedValue())) {
                kq = false;
            }
        }
        return kq;
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel CenterBottom;
    private javax.swing.JPanel Left;
    private javax.swing.JPanel Right;
    private javax.swing.JButton btnAddReset1;
    private javax.swing.JButton btnEditXe;
    private javax.swing.JButton btnEditXe1;
    private javax.swing.JButton btnXeAdd;
    private javax.swing.JComboBox<String> cbxDatCoc;
    private javax.swing.JComboBox<String> cbxMaLoaiXe;
    private javax.swing.JComboBox<String> cbxMaPK;
    private javax.swing.JComboBox<String> cbxSoCMND;
    private javax.swing.JComboBox<String> cbxTinhTrangHD;
    private org.jdesktop.swingx.JXDatePicker dpkNgayLap;
    private org.jdesktop.swingx.JXDatePicker dpkTimeBatDauHD;
    private org.jdesktop.swingx.JXDatePicker dpkTimeKetThucHD;
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton2;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel13;
    private javax.swing.JLabel jLabel14;
    private javax.swing.JLabel jLabel15;
    private javax.swing.JLabel jLabel16;
    private javax.swing.JLabel jLabel17;
    private javax.swing.JLabel jLabel18;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JList<String> jList1;
    private javax.swing.JList<String> jList2;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JScrollPane jScrollPane4;
    private javax.swing.JTextArea tareaGhiChu;
    private javax.swing.JTable tblKh;
    private javax.swing.JTextField txtDiemNhanXe;
    private javax.swing.JTextField txtDiemTraXe;
    private javax.swing.JTextField txtMaHD;
    private javax.swing.JTextField txtMaTT;
    private javax.swing.JTextField txtTienSuaChua;
    private javax.swing.JTextField txtTienThueXe;
    private javax.swing.JTextField txtTongTien;
    // End of variables declaration//GEN-END:variables

    private void loadCBX(String table, JComboBox cbx) {
        if (table == "LOAIXE") {
            String sql = "select * from " + table + " where SoLuong is not NULL";
            try {
                Connection con = databaseHelper.openConnection();
                Statement sttm = con.createStatement();
                ResultSet rs = sttm.executeQuery(sql);
                cbx.removeAllItems();
                while (rs.next()) {
                    cbx.addItem(rs.getString(2));
//                    System.out.println("combobox: " + rs.getString(1));
                }
                con.close();
            } catch (Exception e) {
                e.printStackTrace();
            }
        } else {
            String sql = "select * from " + table + "";
            try {
                Connection con = databaseHelper.openConnection();
                Statement sttm = con.createStatement();
                ResultSet rs = sttm.executeQuery(sql);
                while (rs.next()) {
                    cbx.addItem(rs.getString(1));
                }
                con.close();
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    }
    int temp = 0;

    private int themHopDong() {
        try {
            java.util.Date utilDate1 = dpkNgayLap.getDate();
            java.sql.Date ngayLap = new java.sql.Date(utilDate1.getTime());
            java.util.Date utilDate2 = dpkTimeBatDauHD.getDate();
            java.sql.Date timeBatDauHD = new java.sql.Date(utilDate2.getTime());
            java.util.Date utilDate3 = dpkTimeKetThucHD.getDate();
            java.sql.Date timeKetThucHD = new java.sql.Date(utilDate3.getTime());

            editHopDongDao editHD = new editHopDongDao();
            modelTien t = new modelTien();
            t.setMaTT(txtMaTT.getText());
            t.setTienThueXe(Float.parseFloat(txtTienThueXe.getText()));
            t.setTienSuaChua(Float.parseFloat(txtTienSuaChua.getText()));
            t.setTongTien(Float.parseFloat(txtTongTien.getText()));

            modelHopDong hd = new modelHopDong();
            hd.setMaHD(Integer.parseInt(txtMaHD.getText()));
            hd.setNgayLap((Date) ngayLap);
            hd.setSoCMND(Integer.parseInt(cbxSoCMND.getSelectedItem().toString()));
            hd.setThoiGianBatDauHD((Date) timeBatDauHD);
            hd.setThoiGianKetThucHD((Date) timeKetThucHD);
            hd.setDiaDiemNhanXe(txtDiemNhanXe.getText());
//            System.out.println("Dia diem nhan xe: " + txtDiemNhanXe.getText());
            hd.setDiaDiemTraXe(txtDiemTraXe.getText());
            hd.setGhiChu(tareaGhiChu.getText());
            hd.setMaLoaiXe(editHD.convertLoaiXeToMaLoaiXe(cbxMaLoaiXe.getSelectedItem().toString()));
//            System.out.println("List pk dang thue: " + listModelPhuKienDangThue.toString());
//            System.out.println("Ma List pk dang thue: " + editHD.convertLoaiPKToMaLoaiPK(listModelPhuKienDangThue));
            hd.setMaLoaiPK(editHD.convertLoaiPKToMaLoaiPK(listModelPhuKienDangThue).toString().replace('[', ' ').replace(']', ' ').trim());
            hd.setMaTT(txtMaTT.getText());
            hd.setDatCoc(cbxDatCoc.getSelectedItem().toString());
            hd.setTinhTrang(cbxTinhTrangHD.getSelectedItem().toString());
//            System.out.println("in loi: " + cbxMaLoaiXe.getSelectedItem().toString() + "hehe");
            editHD.insertHopDong(hd, t);

            temp = 1;

        } catch (Exception e) {
            e.printStackTrace();
            temp = 0;
        }
        return temp;
    }

    private void loadDataTable() {
        try {
            DefaultTableModel model = new DefaultTableModel(new String[]{"Ma HD", "Ngay Lap", "so CMND", "Thoi gian bat dau HD", "Thoi gian ket thuc HD", "Dia diem nhan xe", "Dia diem tra xe", "Ghi chu", "Tinh Trang HD", "Ma loai xe", "Ma Loai PK", "Ma TT", "Dat coc", "Tien thue xe", "Tien sua chua", "Tong tien"}, 0) {
                public boolean isCellEditable(int row, int column) {
                    return false;
                }
            };
            String sql = "select * from HOPDONG hd join TIEN t on hd.MaThanhToan=t.MaThanhToan";
            Statement st = databaseHelper.openConnection().createStatement();
            ResultSet rs = st.executeQuery(sql);
            while (rs.next()) {
                int maHD = rs.getInt(1);
                Date ngayLap = rs.getDate(2);
                int soCMND = rs.getInt(3);
                Date thoiGianBatDauHD = rs.getDate(4);
                Date thoiGianKetThucHD = rs.getDate(5);
                String diaDiemNhanXe = rs.getString(6);
                String diaDiemTraXe = rs.getString(7);
                String ghiChu1 = rs.getString(8);
                String maLoaiXe = rs.getString(9);
                String maLoaiPK = rs.getString(10);
                String maTT1 = rs.getString(11);
                String datCoc = rs.getString(12);
//                String maTT2 = rs.getString(13);
                String tinhTrangHD = rs.getString(13);
                float tienThueXe = rs.getFloat(15);
                float tienSuaChua = rs.getFloat(16);
                float tongTien = rs.getFloat(17);
//                String ghiChu2 = rs.getString(17);
                model.addRow(new Object[]{maHD, ngayLap, soCMND, thoiGianBatDauHD, thoiGianKetThucHD, diaDiemNhanXe, diaDiemTraXe, ghiChu1, tinhTrangHD, maLoaiXe, maLoaiPK, maTT1, datCoc, tienThueXe, tienSuaChua, tongTien});

            }
            tblKh.setModel(model);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    private int rowSelected() {
        int row = tblKh.getSelectedRow();
        return row;
    }

    private int capNhatHopDong() {
        try {
            java.util.Date utilDate1 = dpkNgayLap.getDate();
            java.sql.Date ngayLap = new java.sql.Date(utilDate1.getTime());
            java.util.Date utilDate2 = dpkTimeBatDauHD.getDate();
            java.sql.Date timeBatDauHD = new java.sql.Date(utilDate2.getTime());
            java.util.Date utilDate3 = dpkTimeKetThucHD.getDate();
            java.sql.Date timeKetThucHD = new java.sql.Date(utilDate3.getTime());

            editHopDongDao editHD = new editHopDongDao();
            modelTien t = new modelTien();
            t.setMaTT(txtMaTT.getText());
            t.setTienThueXe(Float.parseFloat(txtTienThueXe.getText()));
            t.setTienSuaChua(Float.parseFloat(txtTienSuaChua.getText()));
            t.setTongTien(Float.parseFloat(txtTongTien.getText()));

            modelHopDong hd = new modelHopDong();
            hd.setMaHD(Integer.parseInt(txtMaHD.getText()));
            hd.setNgayLap((Date) ngayLap);
            hd.setSoCMND(Integer.parseInt(cbxSoCMND.getSelectedItem().toString()));
            hd.setThoiGianBatDauHD((Date) timeBatDauHD);
            hd.setThoiGianKetThucHD((Date) timeKetThucHD);
            hd.setDiaDiemNhanXe(txtDiemNhanXe.getText());
            hd.setDiaDiemTraXe(txtDiemTraXe.getText());
            hd.setGhiChu(tareaGhiChu.getText());
            hd.setMaLoaiXe(editHD.convertLoaiXeToMaLoaiXe(cbxMaLoaiXe.getSelectedItem().toString()));
//            hd.setMaLoaiPK(cbxMaPK.getSelectedItem().toString());
            System.out.println("list PK dang thue in thay doi: " + jList2.getModel().toString());
            hd.setMaLoaiPK(editHD.convertLoaiPKToMaLoaiPK((DefaultListModel) jList2.getModel()).toString().replace('[', ' ').replace(']', ' ').trim());
            updateTinhTrangPKSauThayDoi();
            hd.setMaTT(txtMaTT.getText());
            hd.setDatCoc(cbxDatCoc.getSelectedItem().toString());
            hd.setTinhTrang(cbxTinhTrangHD.getSelectedItem().toString());

            editHD.updateHopDong(hd, t, valueOfCBXTinhTrangHD);
            temp = 1;

        } catch (Exception e) {
            e.printStackTrace();
            temp = 0;
        }
        return temp;
    }

    private void loadListBoxSanSang() {
        DefaultListModel listModel1 = new DefaultListModel();
        try {
            String sql = "select * from LOAIPHUKIEN where SoLuong is not NULL";
            Connection con = databaseHelper.openConnection();
            Statement sttm = con.createStatement();
            ResultSet rs = sttm.executeQuery(sql);
            while (rs.next()) {
                listModel1.addElement(rs.getString(2));
            }
            jList1.setModel(listModel1);
        } catch (Exception ex) {
            ex.printStackTrace();
        }
    }

    private void updateTinhTrangPKSauThayDoi() {
        editHopDongDao editHD = new editHopDongDao();
//        System.out.println("in table: " + tblKh.getValueAt(rowSelected(), 10).toString());
//        System.out.println("in list dang cho thue: " + editHD.convertLoaiPKToMaLoaiPK((DefaultListModel) jList2.getModel()));
//        System.out.println("in list dang cho thue size: " + editHD.convertLoaiPKToMaLoaiPK((DefaultListModel) jList2.getModel()).size());
        try {
            String sql = "update LOAIPHUKIEN set where SoLuong is not NULL";
            Connection con = databaseHelper.openConnection();
            Statement sttm = con.createStatement();
            ArrayList<String> listMaPKInTable = new ArrayList<>();
            String[] maPKInTable = tblKh.getValueAt(rowSelected(), 10).toString().split(",");
            for (int i = 0; i < maPKInTable.length; i++) {
//            for (int j = 0; j < editHD.convertLoaiPKToMaLoaiPK((DefaultListModel) jList2.getModel()).size(); j++) {
                if (soSanhMaPK(maPKInTable, editHD.convertLoaiPKToMaLoaiPK((DefaultListModel) jList2.getModel()), i)) {
                    System.out.println("pk cancel: " + i + " " + maPKInTable[i].trim());
//                  
                }
//            }
            }
        } catch (Exception e) {
            e.printStackTrace();
        }

//        System.out.println("list in table Array: " + listMaPKInTable);
    }

    private boolean soSanhMaPK(String[] maPKInTable, ArrayList maPKInJlist, int i) {
        boolean kq = true;
//        for (int i = 0; i < maPKInTable.length; i++) {
        for (int j = 0; j < maPKInJlist.size(); j++) {
//                System.out.println("PK in table"+i+" so sanh: "+maPKInTable[i].trim());
//                System.out.println("PK in list"+j+" so sanh: "+maPKInJlist.get(j).toString());
            if (maPKInTable[i].trim().equals(maPKInJlist.get(j).toString())) {
                kq = false;
                break;
            }

        }
//        }
        return kq;
    }
}
